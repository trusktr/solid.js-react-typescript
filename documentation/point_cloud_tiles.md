# Point Cloud Tiles

Tiled point clouds provide the foundation data layer for the annotator application. 

## Tile Format
Two file formats are supported: [BaseGeometryTileMessage](https://github.com/Signafy/mapper-models/blob/master/src/main/proto/MapTileLayers.proto) and [PointCloudTileMessage](https://github.com/Signafy/mapper-models/blob/master/src/main/proto/PointCloudTileMessage.proto). Either of these can be generated by [RegisteredScansToTiles](https://github.com/Signafy/Perception/tree/develop/apps/Core/RegisteredScansToTiles). The app isn't aware of `tile_index.md` files generated by RegisteredScansToTiles, so the scale parameters for the tiles must be specified as well as the format.

### Configuration
	tile_manager.tile_message_format: BaseGeometryTileMessage
	tile_manager.utm_tile_scale: [8, 8, 8]
	tile_client.tile_scale: _008_008_008

or

	tile_manager.tile_message_format: PointCloudTileMessage
	tile_manager.utm_tile_scale: [8, 8, 8]
	tile_client.tile_scale: _008_008_008

## Super Tiles
Super tiles are the unit of loading and caching sets of tiles. Read all about them [in the code](../packages/annotator-entry-ui/tile/TileManager.ts). Each super tile should contain between one and perhaps thirty tiles, depending on tile size and density. Super tile dimensions are specified in the same units (meters) as tiles.

### Configuration
	tile_manager.super_tile_scale: [16, 8, 16]

### Performance
Depending on the number of tiles and density of the point cloud you may need to tweak these settings.

	tile_manager.initial_super_tiles_to_load: 8
	tile_manager.maximum_super_tiles_to_load: 10000
	tile_manager.maximum_points_to_load: 1000000
	tile_manager.sampling_step: 1

## Load A Batch Of Tiles
The app can load the output of RegisteredScansToTiles using the `Load Annotation` menu option. It will scan the entire directory, store a reference to each tile file, and load as many tile files as it can given the various `tile_manager` configuration options. Tiles that are not loaded immediately appear as wire-framed cubes. They can be loaded on demand by shift-clicking them in the main annotator window.

### Configuration
To automatically load a batch of tiles on start:

	startup.point_cloud_directory: /path/to/BaseGeometryTiles

## Stream Tiles From A Service
Working with many tiles is easier when they stream in to the annotator on demand. In the app's interactive mode the camera center line intersects with the ground plane to define a point of interest. A rectangular area of interest is built around the center point, and any super tiles that intersect the AOI get loaded. In live mode (or fly-through mode), the area around and in front of the the car (that is the current pose) get loaded.

Annotator streams tiles from a service which should be running on localhost. See [the docs](tile_service.md) to set it up.

### Configuration
	annotator.area_of_interest.enable: true
	annotator.area_of_interest.size: [20, 10, 20]

## Debugging
The bounding boxes show the extents of the point cloud (red box) and area-of-interest for streaming tiles (green box).

	annotator.draw_bounding_box: true

The axes helper shows the location and orientation of the origin of the rendering engine's 3D coordinate system. (red=x, green=y, blue=z)

	annotator.axes_helper_length: 10

The compass rose points north in an earth-oriented coordinate system. It floats at the north end of the point cloud bounding box.

	annotator.compass_rose_length: 50
